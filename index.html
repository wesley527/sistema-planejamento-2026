<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Premium ‚Ä¢ Planejamento 2026</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="css/style.css">
<!-- Inicializa Firebase via m√≥dulos (escolha: CDN modular sem build) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
  import { getDatabase, ref, onValue, set, get } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";
  import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

  // Configura√ß√£o do Firebase (substitua se necess√°rio)
  const firebaseConfig = {
    apiKey: "AIzaSyCZI4Rb35MkIPiVk-xWz03eZwEaKeaxFhE",
    authDomain: "sistema-de-planejamento.firebaseapp.com",
    projectId: "sistema-de-planejamento",
    storageBucket: "sistema-de-planejamento.firebasestorage.app",
    messagingSenderId: "151928826868",
    appId: "1:151928826868:web:2b3bc73114259530ab67a1",
    measurementId: "G-7L9KYGE46R"
  };

  // Inicializa Firebase
  const app = initializeApp(firebaseConfig);
  try { getAnalytics(app); } catch(e) { /* Analytics pode falhar em ambientes sem suporte */ }
  const db = getDatabase(app);
  const auth = getAuth(app);

  // Expondo helpers m√≠nimos para os scripts n√£o-modulares existentes (ser√£o extendidos quando o usu√°rio autenticado for obtido)
  window.__firebase = {
    db,
    auth,
    ref: (path) => ref(db, path),
    onValue,
    set,
    get
  };

  // Autentica√ß√£o an√¥nima: exp√µe uid e ref por usu√°rio quando estiver dispon√≠vel
  signInAnonymously(auth).then(({ user }) => {
    window.__firebase.uid = user.uid;
    window.__firebase.refForUser = (p) => ref(db, `/users/${user.uid}/${p}`);
    if(document && document.getElementById){
      const s = document.getElementById('syncStatus');
      if(s) s.innerText = 'üîê Conectado (an√¥nimo)';
    }

    // Migra√ß√£o: se existir dados globais e o usu√°rio ainda n√£o tiver dados, copiar para /users/{uid}/tasks
    (async () => {
      try{
        const perRef = window.__firebase.refForUser('tasks');
        const globalRef = ref(db, '/tasks_premium_2026');
        const perSnap = await window.__firebase.get(perRef);
        const globalSnap = await window.__firebase.get(globalRef);
        const perData = perSnap && perSnap.val();
        const globalData = globalSnap && globalSnap.val();
        if((perData == null || (Array.isArray(perData) && perData.length === 0)) && globalData){
          await window.__firebase.set(perRef, globalData);
          console.info('Migrated global tasks to per-user tasks');
        }
      }catch(e){
        console.warn('Migration error', e);
      }
    })();

  }).catch(e => {
    console.warn('Anon sign-in failed', e);
  });

  onAuthStateChanged(auth, (user) => {
    if(user){
      window.__firebase.uid = user.uid;
      window.__firebase.refForUser = (p) => ref(db, `/users/${user.uid}/${p}`);
    }
  });

  window.firebaseInitialized = true;
</script>

<script defer src="js/github-sync.js"></script>
<script defer src="js/app.js"></script>

<body>

<div class="container">

  <div class="topbar">
    <div class="brand">Sistema Premium ‚Ä¢ Planejamento Escolar 2026</div>
    <div class="status" id="syncStatus">üü¢ Pronto</div>
  </div>

  <h1>Painel de Gest√£o</h1>

  <div class="tabs">
    <button id="tabPed" class="active" onclick="switchTab('ped')">Pedag√≥gico</button>
    <button id="tabCom" onclick="switchTab('com')">Comercial</button>
  </div>

  <div class="controls">
    <input id="date" placeholder="Data">
    <input id="action" placeholder="Descri√ß√£o da a√ß√£o">
    <select id="month"></select>
    <button onclick="addTask()">Adicionar</button>
  </div>

  <div class="filters">
    <select id="filterMonth" onchange="renderApp()">
      <option value="all">Todos os meses</option>
    </select>
    <select id="filterStatus" onchange="renderApp()">
      <option value="all">Todas</option>
      <option value="done">Conclu√≠das</option>
      <option value="pending">Pendentes</option>
    </select>
  </div> 

  <div id="months"></div>

</div>

<!-- Entrypoint (usado quando executar via npm + vite) -->
<script type="module" src="/src/main.js"></script>

</body>
</html>
